<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LoveFuns.site - Romantic Word Game</title>
  <style>
    /* 样式部分 */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
    body { min-height: 100vh; display: flex; flex-direction: column; background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 2rem; width: 100%; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .welcome-screen, .game-screen, .result-screen { background: rgba(255,255,255,0.95); padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 600px; text-align: center; }
    h1 { color: #ff4757; margin-bottom: 1.5rem; font-size: 2.5rem; }
    .rules { text-align: left; margin: 1.5rem 0; line-height: 1.6; }
    .rules ul { list-style-type: none; padding-left: 1rem; }
    .rules li { margin: 0.5rem 0; }
    .button { background: #ff4757; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 2rem; font-size: 1.1rem; cursor: pointer; transition: transform 0.2s; }
    .button:hover { transform: scale(1.05); }
    .progress-bar { display: flex; gap: 0.5rem; margin-bottom: 2rem; justify-content: center; }
    .progress-item { width: 30px; height: 30px; border: 2px solid #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
    .progress-item.correct { background: #2ecc71; border-color: #2ecc71; color: white; }
    .progress-item.wrong { background: #ff4757; border-color: #ff4757; color: white; }
    .game-content { margin: 2rem 0; }
    .pickup-line { font-size: 1.4rem; margin-bottom: 1.5rem; line-height: 1.6; }
    .input-area { display: flex; flex-direction: column; gap: 1rem; margin: 1rem 0; }
    .word-input { padding: 0.5rem; font-size: 1rem; border: 2px solid #ddd; border-radius: 0.5rem; width: 100%; max-width: 300px; margin: 0 auto; }
    .timer { font-size: 1.2rem; color: #ff4757; font-weight: bold; margin: 1rem 0; }
    .result-screen h2 { color: #ff4757; margin-bottom: 1rem; }
    .score { font-size: 2rem; margin: 1rem 0; color: #2ecc71; }
    .rating { font-size: 1.5rem; margin: 1rem 0; color: #ff4757; }
    .hidden { display: none; }
    .answer-feedback { margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 0.5rem; font-size: 1.2rem; color: #2ecc71; }
    .incorrect { color: #ff4757; }
  
</head>
    </style>
  <!-- 引入题库文件 -->
  <script src="love-puns-extended.js"></script>
<body>
  <div class="container">
    <div class="welcome-screen">
      <h1>LoveFuns.site</h1>
      <p>Test your romantic creativity with our pickup line challenge!</p>
      <div class="rules">
        <p>🎮 Game Rules:</p>
        <ul>
          <li>Complete 10 romantic pickup lines by filling in the blanks</li>
          <li>You have 10 seconds for each line</li>
          <li>Levels 1-3: 1 word</li>
          <li>Levels 4-6: 2 words</li>
          <li>Levels 7-9: 3 words</li>
          <li>Level 10: 4 words</li>
          <li>Try to achieve the highest rating: Romance Genius!</li>
        </ul>
      </div>
      <button class="button" onclick="startGame()">Start Game</button>
    </div>

    <div class="game-screen hidden">
      <div class="progress-bar"></div>
      <div class="timer">10</div>
      <div class="game-content">
        <div class="pickup-line"></div>
        <div class="input-area"></div>
        <div class="answer-feedback hidden"></div>
      </div>
      <button class="button submit-btn hidden" onclick="submitAnswer()">Submit</button>
    </div>

    <div class="result-screen hidden">
      <h2>Game Over!</h2>
      <div class="score"></div>
      <div class="rating"></div>
      <button class="button" onclick="restartGame()">Play Again</button>
    </div>
  </div>

  <script>
    // 全局变量与题库相关的函数
    let currentQuestion = null;
    let remainingQuestions = {};
    const totalLevels = 10; // 游戏总关卡数

    function shuffle(array) {
      let copy = array.slice();
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    // 初始化题库：为每个难度打乱题库数据
    function initQuestionPools() {
      // QUESTION_BANK 从 love-puns-extended.js 中加载
      remainingQuestions = {
        "1_word": shuffle(QUESTION_BANK["1_word"].slice()),
        "2_words": shuffle(QUESTION_BANK["2_words"].slice()),
        "3_words": shuffle(QUESTION_BANK["3_words"].slice()),
        "4_words": shuffle(QUESTION_BANK["4_words"].slice())
      };
    }

    // 根据当前关卡获取对应题目
    function getQuestionForLevel(level) {
      let category = "";
      if (level < 3) {
        category = "1_word";
      } else if (level < 6) {
        category = "2_words";
      } else if (level < 9) {
        category = "3_words";
      } else {
        category = "4_words";
      }
      if (remainingQuestions[category].length === 0) {
        remainingQuestions[category] = shuffle(QUESTION_BANK[category].slice());
      }
      return remainingQuestions[category].pop();
    }

    // 游戏逻辑部分
    let currentLevel = 0;
    let score = 0;
    let timer;
    let timeLeft;
    let submissionEnabled = true;

    function startGame() {
      initQuestionPools();
      currentLevel = 0;
      score = 0;
      document.querySelector('.welcome-screen').classList.add('hidden');
      document.querySelector('.result-screen').classList.add('hidden');
      document.querySelector('.game-screen').classList.remove('hidden');
      initializeProgressBar();
      startLevel();
    }

    function initializeProgressBar() {
      const progressBar = document.querySelector('.progress-bar');
      progressBar.innerHTML = '';
      for (let i = 0; i < totalLevels; i++) {
        progressBar.innerHTML += `<div class="progress-item">${i + 1}</div>`;
      }
    }

    function startLevel() {
      if (currentLevel >= totalLevels) {
        endGame();
        return;
      }
      submissionEnabled = true;
      // 获取当前关卡题目并保存到 currentQuestion
      currentQuestion = getQuestionForLevel(currentLevel);
      // 显示题目文本
      document.querySelector('.pickup-line').textContent = currentQuestion.template;
      const inputArea = document.querySelector('.input-area');
      const answerFeedback = document.querySelector('.answer-feedback');
      const submitBtn = document.querySelector('.submit-btn');

      inputArea.innerHTML = '';
      answerFeedback.classList.add('hidden');
      submitBtn.disabled = false;

      // 根据题目空位数量生成对应输入框
      for (let i = 0; i < currentQuestion.blanks.length; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'word-input';
        input.placeholder = `Word ${i + 1}`;
        inputArea.appendChild(input);
      }

      submitBtn.classList.add('hidden');
      startTimer();
    }

    function startTimer() {
      timeLeft = 10;
      updateTimer();
      if (timer) clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        updateTimer();
        if (timeLeft <= 0) {
          clearInterval(timer);
          document.querySelector('.submit-btn').classList.remove('hidden');
        }
      }, 1000);
    }

    function updateTimer() {
      document.querySelector('.timer').textContent = timeLeft;
    }

    function submitAnswer() {
      if (!submissionEnabled) return;
      submissionEnabled = false;
      clearInterval(timer);

      const inputs = document.querySelectorAll('.word-input');
      let correct = true;
      // 对比每个空位的用户输入和正确答案（忽略大小写、空白）
      currentQuestion.blanks.forEach((blank, i) => {
        const userInput = inputs[i].value.toLowerCase().trim();
        const correctAnswer = blank.answer.toLowerCase();
        if (userInput !== correctAnswer) {
          correct = false;
        }
      });

      const progressItems = document.querySelectorAll('.progress-item');
      progressItems[currentLevel].classList.add(correct ? 'correct' : 'wrong');

      if (correct) score += (currentLevel + 1) * 10;

      const answerFeedback = document.querySelector('.answer-feedback');
      answerFeedback.classList.remove('hidden');
      answerFeedback.classList.toggle('incorrect', !correct);
      answerFeedback.textContent = correct ?
        "Correct! 🎉" :
        `Incorrect. The correct answer${currentQuestion.blanks.length > 1 ? 's are' : ' is'}: ${currentQuestion.blanks.map(b => b.answer).join(', ')}`;

      inputs.forEach(input => input.disabled = true);
      document.querySelector('.submit-btn').disabled = true;
      currentLevel++;

      setTimeout(() => {
        startLevel();
      }, 2000);
    }

    function endGame() {
      document.querySelector('.game-screen').classList.add('hidden');
      document.querySelector('.result-screen').classList.remove('hidden');

      const scoreElement = document.querySelector('.score');
      const ratingElement = document.querySelector('.rating');
      const totalScore = totalLevels * 10 * (totalLevels + 1) / 2;
      scoreElement.textContent = `Score: ${score}/${totalScore}`;

      let rating;
      if (score >= 0.8 * totalScore) {
        rating = "Romance Genius! 💝";
      } else if (score >= 0.6 * totalScore) {
        rating = "Smooth Talker! 💫";
      } else if (score >= 0.4 * totalScore) {
        rating = "Charming Beginner! 💌";
      } else {
        rating = "Keep Practicing! 💪";
      }
      ratingElement.textContent = rating;
    }

    function restartGame() {
      if (timer) clearInterval(timer);
      startGame();
    }
  </script>
</body>
</html>
